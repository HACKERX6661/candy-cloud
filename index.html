<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candy Cloud Shop</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); 
            background-size: 400% 400%; 
            animation: gradient 15s ease infinite; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
        }
        @keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .shop-container { 
            background: rgba(255, 255, 255, 0.95); 
            padding: 30px; 
            border-radius: 20px; 
            max-width: 450px; 
            width: 90%; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            text-align: center;
        }
        .logo-header { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid #e73c7e; margin-bottom: 10px; }
        .product-card { border: 1px solid #ddd; border-radius: 12px; margin-bottom: 12px; padding: 15px; display: flex; align-items: center; text-align: left; background: #fff; }
        .product-card img { width: 60px; height: 60px; border-radius: 8px; margin-right: 15px; object-fit: contain; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .address-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 10px; }
        .buy-button { background: #e73c7e; color: white; padding: 15px; border: none; border-radius: 10px; font-size: 18px; cursor: pointer; width: 100%; font-weight: bold; }
    </style>
</head>
<body>
    <div id="auth-gate" class="shop-container">
        <h2>üç≠ Candy Cloud Login</h2>
        <input type="email" id="userEmail" placeholder="E-Mail f√ºr Code">
        <button onclick="sendCode()" class="buy-button">Code senden</button>
        <div id="code-section" style="display: none; margin-top: 20px;">
            <input type="text" id="inputCode" placeholder="Code eingeben">
            <button onclick="verifyCode()" class="buy-button" style="background: #23d5ab;">Shop √∂ffnen</button>
        </div>
    </div>

    <div id="main-shop" class="shop-container" style="display: none;">
        <img src="Candy-Cloud/saure_strips.jpg" class="logo-header" alt="Logo">
        <h1>Candy Cloud</h1>
        <form id="orderForm" action="https://formspree.io/f/mjgveeel" method="POST">
            <div class="product-card">
                <img src="Candy-Cloud/saure_strips.jpg">
                <div style="flex-grow:1;"><strong>Saure Strips</strong><br>2,00 ‚Ç¨</div>
                <input type="checkbox" name="Strips" value="Ja" class="item-check" data-price="2.00">
            </div>
            <input type="text" name="Kunde" placeholder="Name" required>
            <input type="email" id="autoEmail" name="Email" readonly required style="background:#f0f0f0;">
            <input type="tel" name="Telefon" placeholder="Telefonnummer" required>
            <input type="text" name="Strasse" placeholder="Stra√üe" required>
            <div class="address-grid">
                <input type="text" name="PLZ" placeholder="PLZ" required>
                <input type="text" name="Ort" placeholder="Ort" required>
            </div>
            <input type="hidden" id="totalAmount" name="GESAMTSUMME">
            <button type="button" onclick="calculateAndSend()" class="buy-button">Bestellung abschicken</button>
        </form>
    </div>

    <script>
        (function() { emailjs.init("G5J0iTvi3DSK0C6p9"); })();
        let generatedCode, loginEmail;
        function sendCode() {
            const email = document.getElementById('userEmail').value;
            loginEmail = email;
            generatedCode = Math.floor(100000 + Math.random() * 900000);
            emailjs.send("service_ce5qg71", "template_3ucxs1x", { to_email: email, code: generatedCode })
                .then(() => { document.getElementById('code-section').style.display = 'block'; });
        }
        function verifyCode() {
            if(document.getElementById('inputCode').value == generatedCode) {
                document.getElementById('auth-gate').style.display = 'none';
                document.getElementById('main-shop').style.display = 'block';
                document.getElementById('autoEmail').value = loginEmail;
            }
        }
        function calculateAndSend() {
            let summe = 2.50;
            document.querySelectorAll('.item-check:checked').forEach(i => summe += parseFloat(i.dataset.price));
            document.getElementById('totalAmount').value = summe.toFixed(2) + " ‚Ç¨";
            document.getElementById('orderForm').submit();
        }
    </script>
</body>
</html>
